<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trading Daily Journal Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container">
    <header class="hero" title="Tổng quan hiệu suất giao dịch, thời điểm cập nhật và trạng thái dashboard.">
      <div class="hero-top">
        <div>
          <p class="kicker">Trading Daily Journal</p>
          <h1>Performance Dashboard</h1>
          <p id="last-updated">Loading summary...</p>
        </div>
        <button id="theme-toggle" type="button">Dark</button>
      </div>
    </header>

    <section class="kpi-grid">
      <article class="kpi-card" title="Lãi/lỗ thuần từ giao dịch (không gồm nạp/rút)."><h2>Trading PnL</h2><p id="kpi-trade-pnl">-</p></article>
      <article class="kpi-card" title="Lãi/lỗ ròng sau khi cộng cả cashflow liên quan."><h2>Net PnL</h2><p id="kpi-net">-</p></article>
      <article class="kpi-card" title="Tổng số position trong khoảng lọc hiện tại."><h2>Total Positions</h2><p id="kpi-positions">-</p></article>
      <article class="kpi-card" title="Tỷ lệ position có lãi trên tổng position đóng."><h2>Win Rate</h2><p id="kpi-winrate">-</p></article>
      <article class="kpi-card" title="Tổng lợi nhuận dương (gross profit)."><h2>Gross Profit</h2><p id="kpi-gross-profit">-</p></article>
      <article class="kpi-card" title="Tổng lỗ âm (gross loss)."><h2>Gross Loss</h2><p id="kpi-loss">-</p></article>
    </section>

    <section class="panel" title="Biểu đồ lãi/lỗ ròng theo từng ngày VN (GMT+7).">
      <div class="panel-head">
        <h2>
          Daily Net Profit
          <span
            class="formula-tip"
            title="Formula (VN day, GMT+7): daily_net = sum(net_profit) for trade_date_vn in [00:00:00..23:59:59]. Chart shows latest 7 trading days."
            aria-label="Daily Net Profit formula"
            >i</span
          >
        </h2>
      </div>
      <div class="filters" title="Chọn khoảng ngày để lọc dữ liệu biểu đồ theo ngày VN (GMT+7).">
        <label>From
          <input id="summary-from" type="date" title="Ngày bắt đầu theo GMT+7 (00:00:00)." />
        </label>
        <label>To
          <input id="summary-to" type="date" title="Ngày kết thúc theo GMT+7 (23:59:59)." />
        </label>
      </div>
      <div class="chart-wrap">
        <canvas id="pnl-chart"></canvas>
      </div>
    </section>

    <section class="panel analytics-layout" title="Khối phân tích nâng cao gồm snapshot, tăng trưởng và cashflow.">
      <aside class="stats-side" title="Các chỉ số tổng hợp nhanh để đánh giá chất lượng hiệu suất.">
        <h3>Performance Snapshot</h3>
        <ul class="stats-list">
          <li><span>Abs Gain</span><strong id="stat-abs-gain">-</strong></li>
          <li><span>Trading Gain %</span><strong id="stat-gain-pct">-</strong></li>
          <li><span>Max Drawdown</span><strong id="stat-max-dd">-</strong></li>
          <li><span>Profit Factor</span><strong id="stat-pf">-</strong></li>
          <li><span>Total Deposits</span><strong id="stat-dep">-</strong></li>
          <li><span>Total Withdrawals</span><strong id="stat-wd">-</strong></li>
        </ul>
      </aside>
      <div class="chart-main" title="Đường tăng trưởng lũy kế và cột dòng tiền nạp/rút theo ngày.">
        <div class="panel-head">
          <h2>
            Growth And Cashflow
            <span
              class="formula-tip"
              title="Growth line: cumulative(trading_pnl), where trading_pnl = gross_profit + gross_loss. Cashflow bars: deposit = total_deposit, withdrawal = -total_withdrawal."
              aria-label="Growth And Cashflow formula"
              >i</span
            >
          </h2>
        </div>
        <div class="chart-wrap">
          <canvas id="growth-chart"></canvas>
        </div>
      </div>
    </section>

    <section class="chart-grid">
      <section class="panel" title="Mức sụt giảm vốn theo từng ngày giao dịch.">
        <div class="panel-head">
          <h2>
            Drawdown By Day
            <span
              class="formula-tip"
              title="For each VN day: drawdown = growth - running_peak(growth). Values are <= 0."
              aria-label="Drawdown By Day formula"
              >i</span
            >
          </h2>
        </div>
        <div class="chart-wrap small"><canvas id="drawdown-chart"></canvas></div>
      </section>
      <section class="panel" title="Tổng Trading PnL theo từng tháng (YYYY-MM).">
        <div class="panel-head">
          <h2>
            Monthly Trading PnL
            <span
              class="formula-tip"
              title="For each month (YYYY-MM): monthly_trading_pnl = sum(daily_trading_pnl), where daily_trading_pnl = gross_profit + gross_loss."
              aria-label="Monthly Trading PnL formula"
              >i</span
            >
          </h2>
        </div>
        <div class="chart-wrap small"><canvas id="monthly-chart"></canvas></div>
      </section>
      <section class="panel" title="Hiệu suất theo từng mã symbol.">
        <div class="panel-head"><h2>Symbol Performance</h2></div>
        <div class="chart-wrap small"><canvas id="symbol-chart"></canvas></div>
      </section>
      <section class="panel" title="Hiệu suất theo thứ trong tuần (theo giờ VN).">
        <div class="panel-head"><h2>Weekday Performance</h2></div>
        <div class="chart-wrap small"><canvas id="weekday-chart"></canvas></div>
      </section>
    </section>

    <section class="panel" title="Bảng thống kê theo các khoảng thời gian chuẩn.">
      <div class="panel-head"><h2>Period Stats</h2></div>
      <div class="table-wrap">
        <table id="periods-table">
          <thead>
            <tr>
              <th>Period</th>
              <th>Trading PnL</th>
              <th>Net PnL</th>
              <th>Win Rate</th>
              <th>Trades</th>
              <th>Positions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="panel" title="Bảng tổng hợp theo ngày VN, dùng để đối chiếu với chart và KPI.">
      <div class="panel-head">
        <h2>Daily Summary</h2>
      </div>
      <div class="table-wrap">
        <table id="summary-table">
          <thead>
            <tr>
              <th>Date (VN)</th>
              <th>Positions</th>
              <th>Deals</th>
              <th>Win</th>
              <th>Loss</th>
              <th>Trading PnL</th>
              <th>Cashflow</th>
              <th>Net PnL</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="panel" id="details-section" title="Chi tiết giao dịch để cross-check từng event/position.">
      <div class="panel-head">
        <h2>Trade Details (Cross-check)</h2>
        <p id="details-status">Loading on demand when this section is visible...</p>
      </div>
      <div class="view-switch" title="Chuyển giữa góc nhìn Position và Event.">
        <button id="view-position" type="button" class="active" title="Nhóm theo position để xem kết quả đóng/mở theo cụm.">Position View</button>
        <button id="view-event" type="button" title="Xem từng event/deal riêng lẻ.">Event View</button>
      </div>

      <div class="filters" title="Lọc dữ liệu chi tiết theo ngày VN (GMT+7), action và symbol.">
        <label>From
          <input id="details-from" type="date" title="Ngày bắt đầu theo GMT+7 (00:00:00)." />
        </label>
        <label>To
          <input id="details-to" type="date" title="Ngày kết thúc theo GMT+7 (23:59:59)." />
        </label>
        <label>Date
          <select id="filter-date" title="Lọc nhanh theo đúng 1 ngày VN cụ thể."><option value="">All</option></select>
        </label>
        <label>Action
          <select id="filter-action" title="Lọc theo loại hành động giao dịch.">
            <option value="">All</option>
            <option value="Buy">Buy</option>
            <option value="Sell">Sell</option>
            <option value="Deposit">Deposit</option>
            <option value="Withdrawal">Withdrawal</option>
            <option value="BalanceAdjustment">BalanceAdjustment</option>
          </select>
        </label>
        <label>Symbol
          <input id="filter-symbol" type="text" placeholder="e.g. GOLD" title="Nhập mã symbol để lọc (không phân biệt hoa thường)." />
        </label>
        <label style="align-self:end">
          <button id="export-details" type="button" class="details-export-btn" title="Xuất CSV theo bộ lọc hiện tại (ngày VN GMT+7).">Export CSV</button>
        </label>
      </div>

      <div class="table-wrap">
        <table id="details-table" class="details-table">
          <thead>
            <tr>
              <th data-sort="trade_date_vn">Date</th>
              <th data-sort="close_time_vn">Close Time (VN)</th>
              <th data-sort="event_id">Event ID</th>
              <th data-sort="position_id">Position ID</th>
              <th data-sort="deal_role">Role</th>
              <th data-sort="action">Action</th>
              <th data-sort="symbol">Symbol</th>
              <th data-sort="lots">Lots</th>
              <th data-sort="close_price">Price</th>
              <th data-sort="position_pnl">Position PnL</th>
              <th data-sort="profit">Profit</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <table id="positions-table" class="details-table hidden">
          <thead>
            <tr>
              <th data-psort="trade_date_vn">Date</th>
              <th data-psort="account_id">Account</th>
              <th data-psort="position_id">Position ID</th>
              <th data-psort="symbol">Symbol</th>
              <th data-psort="entry_time_vn">Entry Time</th>
              <th data-psort="exit_time_vn">Exit Time</th>
              <th data-psort="entry_price">Entry Price</th>
              <th data-psort="exit_price">Exit Price</th>
              <th data-psort="lots">Lots</th>
              <th data-psort="deals_count">Deals</th>
              <th data-psort="position_pnl">Position PnL</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="pagination" title="Phân trang dữ liệu, có thể tự tải thêm khi đi tới trang cuối.">
        <button id="prev-page" type="button" title="Về trang trước.">Previous</button>
        <span id="page-info">Page 0 / 0</span>
        <button id="next-page" type="button" title="Sang trang sau hoặc tải thêm dữ liệu.">Next</button>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="app.js?v=20260227-1"></script>
</body>
</html>
