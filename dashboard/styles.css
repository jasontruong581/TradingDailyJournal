:root {
  --bg: #f5f8ff;
  --panel: #ffffff;
  --text: #13203a;
  --muted: #64748b;
  --line: #e3eaf8;
  --brand: #2e6cff;
  --good: #12a150;
  --bad: #d92d20;
  --shadow: 0 10px 30px rgba(18, 43, 85, 0.08);
}

body[data-theme="dark"] {
  --bg: #0c111d;
  --panel: #141b2d;
  --text: #d9e4ff;
  --muted: #90a2c9;
  --line: #273353;
  --brand: #5c8dff;
  --good: #37d67a;
  --bad: #ff6b60;
  --shadow: 0 12px 28px rgba(0, 0, 0, 0.4);
}

* { box-sizing: border-box; }
html, body { margin: 0; }
body {
  font-family: "Manrope", sans-serif;
  color: var(--text);
  background:
    radial-gradient(1000px 360px at 0% 0%, rgba(46, 108, 255, 0.16), transparent 55%),
    radial-gradient(800px 300px at 100% 0%, rgba(14, 165, 164, 0.14), transparent 55%),
    var(--bg);
}
.container { max-width: 1240px; margin: 0 auto; padding: 28px 18px 44px; }

.hero, .kpi-card, .panel { background: var(--panel); border: 1px solid var(--line); box-shadow: var(--shadow); }
.hero { border-radius: 20px; padding: 20px; }
.hero-top { display: flex; justify-content: space-between; gap: 12px; align-items: flex-start; }
#theme-toggle { border: 1px solid var(--line); border-radius: 10px; padding: 8px 12px; background: transparent; color: var(--text); font: inherit; cursor: pointer; }
.hero h1 { margin: 0; font-weight: 800; font-size: clamp(28px, 4vw, 46px); letter-spacing: -0.02em; }
.kicker { margin: 0 0 8px; text-transform: uppercase; letter-spacing: 0.1em; font-size: 12px; color: var(--brand); font-weight: 700; }
#last-updated { margin: 8px 0 0; color: var(--muted); }

.kpi-grid { display: grid; gap: 12px; grid-template-columns: repeat(6, minmax(0, 1fr)); margin: 16px 0; }
.kpi-card { border-radius: 16px; padding: 14px; }
.kpi-card h2 { margin: 0 0 8px; font-size: 12px; color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.04em; }
.kpi-card p { margin: 0; font-size: 24px; font-weight: 800; letter-spacing: -0.015em; }

.panel { margin-top: 14px; border-radius: 18px; padding: 14px; }
.panel-head { display: flex; justify-content: space-between; align-items: baseline; gap: 10px; }
.panel-head h2 { margin: 0 0 10px; font-size: 18px; }
.panel-head p { margin: 0 0 10px; color: var(--muted); font-size: 13px; }
.formula-tip {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  margin-left: 6px;
  border: 1px solid var(--line);
  border-radius: 999px;
  color: var(--muted);
  font-size: 11px;
  font-weight: 800;
  cursor: help;
  vertical-align: middle;
  transition: color 160ms ease, border-color 160ms ease, box-shadow 160ms ease;
}
.formula-tip:hover {
  color: var(--brand);
  border-color: var(--brand);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--brand) 18%, transparent);
}

.chart-wrap { position: relative; width: 100%; height: 320px; }
.chart-wrap canvas { width: 100% !important; height: 100% !important; display: block; }
.chart-wrap.small { height: 260px; }

.analytics-layout {
  display: grid;
  grid-template-columns: 300px minmax(0, 1fr);
  gap: 12px;
  align-items: stretch;
}
.stats-side {
  border: 1px dashed var(--line);
  border-radius: 14px;
  padding: 12px;
}
.stats-side h3 {
  margin: 0 0 10px;
  font-size: 15px;
}
.stats-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.stats-list li {
  display: flex;
  justify-content: space-between;
  gap: 8px;
  padding: 8px 0;
  border-bottom: 1px solid var(--line);
}
.stats-list li:last-child {
  border-bottom: 0;
}
.stats-list span {
  color: var(--muted);
  font-size: 13px;
}
.stats-list strong {
  font-size: 14px;
}

.chart-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
}

.filters { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; }
.view-switch { display: flex; gap: 8px; margin-bottom: 10px; }
.view-switch button { border: 1px solid var(--line); border-radius: 10px; padding: 7px 12px; background: var(--panel); color: var(--text); font: inherit; font-weight: 700; cursor: pointer; }
.view-switch button.active { background: var(--brand); color: #fff; border-color: var(--brand); }
.details-export-btn {
  border: 1px solid var(--line);
  border-radius: 10px;
  padding: 7px 12px;
  background: var(--panel);
  color: var(--text);
  font: inherit;
  font-weight: 700;
  cursor: pointer;
  transition: transform 120ms ease, box-shadow 160ms ease, border-color 160ms ease, background-color 160ms ease;
}
.details-export-btn:hover {
  border-color: color-mix(in srgb, var(--brand) 65%, var(--line));
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--brand) 20%, transparent), 0 8px 18px rgba(46, 108, 255, 0.18);
  transform: translateY(-1px);
}
.details-export-btn:active {
  transform: translateY(0);
}
.filters label { display: grid; gap: 4px; color: var(--muted); font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.04em; }
.filters input, .filters select, .pagination button {
  border: 1px solid var(--line); border-radius: 10px; padding: 8px 10px; font: inherit;
  background: var(--panel); color: var(--text);
}

.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; }
th, td { padding: 10px; border-bottom: 1px solid var(--line); text-align: left; white-space: nowrap; }
th { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.04em; }
#details-table thead th[data-sort] { cursor: pointer; }
#positions-table thead th[data-psort] { cursor: pointer; }
.hidden { display: none; }

.pagination { display: flex; justify-content: flex-end; align-items: center; gap: 8px; margin-top: 10px; }
.pagination button { cursor: pointer; font-weight: 700; }
.pagination button:disabled { opacity: 0.45; cursor: not-allowed; }
#page-info { color: var(--muted); font-weight: 700; min-width: 150px; text-align: center; }

.pos { color: var(--good); }
.neg { color: var(--bad); }

@media (max-width: 1080px) { .kpi-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
@media (max-width: 760px) {
  .kpi-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
  .panel-head { flex-direction: column; align-items: flex-start; }
  .hero-top { flex-direction: column; }
  .analytics-layout { grid-template-columns: 1fr; }
  .chart-grid { grid-template-columns: 1fr; }
}
@media (max-width: 520px) {
  .kpi-grid { grid-template-columns: 1fr; }
  .chart-wrap { height: 230px; }
}
